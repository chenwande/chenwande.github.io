{"version":3,"sources":["utils/http.ts","utils/use-async.ts","components/profiler.tsx","components/error-boundary.tsx","App.tsx","reportWebVitals.ts","context/index.tsx","index.tsx","auth-provider.ts","components/lib.tsx","context/auth-context.tsx","utils/index.ts"],"names":["apiUrl","process","http","endpoint","a","data","token","headers","customConfig","config","method","Authorization","toUpperCase","qs","stringify","body","JSON","window","fetch","then","response","status","auth","location","reload","Promise","reject","message","json","ok","useHttp","user","useAuth","useCallback","defaultInitialState","stat","error","defaultConfig","throwOnError","useAsync","initialState","initialConfig","useReducer","state","action","safeDispatch","dispatch","mountedRef","useMountedRef","current","useSafeDispatch","useState","retry","setRetry","setData","setError","run","promise","runConfig","Error","catch","isIdle","isLoading","isError","isSuccess","queue","setInterval","length","queueToSend","console","log","Profiler","metadata","phases","props","onRender","id","phase","actualDuration","baseDuration","startTime","commitTime","interactions","includes","push","ErrorBoundary","this","fallbackRender","children","React","Component","AuthenticatedApp","lazy","UnauthenticatedApp","App","className","FullPageErrorFallback","Suspense","fallback","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","AppProviders","queryClient","QueryClient","defaultOptions","queries","refetchOnWindowFocus","client","loadServer","ReactDOM","render","StrictMode","document","getElementById","localStorageKey","getToken","localStorage","getItem","handleUserResponse","setItem","login","register","logout","removeItem","Row","styled","div","between","undefined","marginBottom","gap","FullPage","FullPageLoading","size","ErrorBox","value","Text","type","ButtonNoPadding","Button","ScreenContainer","bootstrapUser","AuthContext","createContext","displayName","AuthProvider","setUser","useQueryClient","useMount","Provider","form","clear","context","useContext","cleanObject","object","result","Object","keys","forEach","key","isVoid","callback","useEffect","useDebounce","delay","debouncedValue","setDebouncedValue","timeout","setTimeout","clearTimeout","useDocumentTitle","title","keepOnUnmount","oldTitle","useRef","resetRoute","href","origin","subset","obj","filteredEntries","entries","filter","fromEntries"],"mappings":"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","file":"static/js/main.52083eaf.chunk.js","sourcesContent":["import qs from \"qs\";\nimport * as auth from \"auth-provider\";\nimport { useAuth } from \"context/auth-context\";\nimport { useCallback } from \"react\";\n\nconst apiUrl = process.env.REACT_APP_API_URL;\n\ninterface Config extends RequestInit {\n  token?: string;\n  data?: object;\n}\n\nexport const http = async (\n  endpoint: string,\n  { data, token, headers, ...customConfig }: Config = {}\n) => {\n  const config = {\n    method: \"GET\",\n    headers: {\n      Authorization: token ? `Bearer ${token}` : \"\",\n      \"Content-Type\": data ? \"application/json\" : \"\",\n    },\n    ...customConfig,\n  };\n\n  if (config.method.toUpperCase() === \"GET\") {\n    endpoint += `?${qs.stringify(data)}`;\n  } else {\n    config.body = JSON.stringify(data || {});\n  }\n\n  // axios 和 fetch 的表现不一样，axios可以直接在返回状态不为2xx的时候抛出异常\n  return window\n    .fetch(`${apiUrl}/${endpoint}`, config)\n    .then(async (response) => {\n      if (response.status === 401) {\n        await auth.logout();\n        window.location.reload();\n        return Promise.reject({ message: \"请重新登录\" });\n      }\n      const data = await response.json();\n      if (response.ok) {\n        return data;\n      } else {\n        return Promise.reject(data);\n      }\n    });\n};\n\n// JS 中的typeof，是在runtime时运行的\n// return typeof 1 === 'number'\n\n// TS 中的typeof，是在静态环境运行的\n// return (...[endpoint, config]: Parameters<typeof http>) =>\nexport const useHttp = () => {\n  const { user } = useAuth();\n  // utility type 的用法：用泛型给它传入一个其他类型，然后utility type对这个类型进行某种操作\n  return useCallback(\n    (...[endpoint, config]: Parameters<typeof http>) =>\n      http(endpoint, { ...config, token: user?.token }),\n    [user?.token]\n  );\n};\n\n// 类型别名、Utility Type 讲解\n// 联合类型\nlet myFavoriteNumber: string | number;\nmyFavoriteNumber = \"seven\";\nmyFavoriteNumber = 7;\n// TS2322: Type '{}' is not assignable to type 'string | number'.\n// myFavoriteNumber = {}\nlet jackFavoriteNumber: string | number;\n\n// 类型别名在很多情况下可以和interface互换\n// interface Person {\n//   name: string\n// }\n// type Person = { name: string }\n// const xiaoMing: Person = {name: 'xiaoming'}\n\n// 类型别名, interface 在这种情况下没法替代type\ntype FavoriteNumber = string | number;\nlet roseFavoriteNumber: FavoriteNumber = \"6\";\n\n// interface 也没法实现Utility type\ntype Person = {\n  name: string;\n  age: number;\n};\nconst xiaoMing: Partial<Person> = {};\nconst shenMiRen: Omit<Person, \"name\" | \"age\"> = {};\ntype PersonKeys = keyof Person;\ntype PersonOnlyName = Pick<Person, \"name\" | \"age\">;\ntype Age = Exclude<PersonKeys, \"name\">;\n\n// Partial 的实现\ntype Partial<T> = {\n  [P in keyof T]?: T[P];\n};\n","import { useCallback, useReducer, useState } from \"react\";\nimport { useMountedRef } from \"utils/index\";\n\ninterface State<D> {\n  error: Error | null;\n  data: D | null;\n  stat: \"idle\" | \"loading\" | \"error\" | \"success\";\n}\n\nconst defaultInitialState: State<null> = {\n  stat: \"idle\",\n  data: null,\n  error: null,\n};\n\nconst defaultConfig = {\n  throwOnError: false,\n};\n\nconst useSafeDispatch = <T>(dispatch: (...args: T[]) => void) => {\n  const mountedRef = useMountedRef();\n  return useCallback(\n    (...args: T[]) => (mountedRef.current ? dispatch(...args) : void 0),\n    [dispatch, mountedRef]\n  );\n};\n\nexport const useAsync = <D>(\n  initialState?: State<D>,\n  initialConfig?: typeof defaultConfig\n) => {\n  const config = { ...defaultConfig, ...initialConfig };\n  const [state, dispatch] = useReducer(\n    (state: State<D>, action: Partial<State<D>>) => ({ ...state, ...action }),\n    {\n      ...defaultInitialState,\n      ...initialState,\n    }\n  );\n  const safeDispatch = useSafeDispatch(dispatch);\n  // useState直接传入函数的含义是：惰性初始化；所以，要用useState保存函数，不能直接传入函数\n  // https://codesandbox.io/s/blissful-water-230u4?file=/src/App.js\n  const [retry, setRetry] = useState(() => () => {});\n\n  const setData = useCallback(\n    (data: D) =>\n      safeDispatch({\n        data,\n        stat: \"success\",\n        error: null,\n      }),\n    [safeDispatch]\n  );\n\n  const setError = useCallback(\n    (error: Error) =>\n      safeDispatch({\n        error,\n        stat: \"error\",\n        data: null,\n      }),\n    [safeDispatch]\n  );\n\n  // run 用来触发异步请求\n  const run = useCallback(\n    (promise: Promise<D>, runConfig?: { retry: () => Promise<D> }) => {\n      if (!promise || !promise.then) {\n        throw new Error(\"请传入 Promise 类型数据\");\n      }\n      setRetry(() => () => {\n        if (runConfig?.retry) {\n          run(runConfig?.retry(), runConfig);\n        }\n      });\n      safeDispatch({ stat: \"loading\" });\n      return promise\n        .then((data) => {\n          setData(data);\n          return data;\n        })\n        .catch((error) => {\n          // catch会消化异常，如果不主动抛出，外面是接收不到异常的\n          setError(error);\n          if (config.throwOnError) return Promise.reject(error);\n          return error;\n        });\n    },\n    [config.throwOnError, setData, setError, safeDispatch]\n  );\n\n  return {\n    isIdle: state.stat === \"idle\",\n    isLoading: state.stat === \"loading\",\n    isError: state.stat === \"error\",\n    isSuccess: state.stat === \"success\",\n    run,\n    setData,\n    setError,\n    // retry 被调用时重新跑一遍run，让state刷新一遍\n    retry,\n    ...state,\n  };\n};\n","import React, { ProfilerOnRenderCallback, ProfilerProps } from \"react\";\n\ntype Props = { metadata?: any; phases?: (\"mount\" | \"update\")[] } & Omit<\n  ProfilerProps,\n  \"onRender\"\n>;\n\nlet queue: unknown[] = [];\n\nconst sendProfileQueue = () => {\n  if (!queue.length) {\n    return;\n  }\n  const queueToSend = [...queue];\n  queue = [];\n  console.log(queueToSend);\n};\n\nsetInterval(sendProfileQueue, 5000);\n\nexport const Profiler = ({ metadata, phases, ...props }: Props) => {\n  const reportProfile: ProfilerOnRenderCallback = (\n    id,\n    phase,\n    actualDuration,\n    baseDuration,\n    startTime,\n    commitTime,\n    interactions\n  ) => {\n    if (!phases || phases.includes(phase)) {\n      queue.push({\n        id,\n        phase,\n        actualDuration,\n        baseDuration,\n        startTime,\n        commitTime,\n        interactions,\n        metadata,\n      });\n    }\n  };\n\n  return <React.Profiler onRender={reportProfile} {...props} />;\n};\n","import React from \"react\";\n\ntype FallbackRender = (props: { error: Error | null }) => React.ReactElement;\n\n// https://github.com/bvaughn/react-error-boundary\nexport class ErrorBoundary extends React.Component<\n  React.PropsWithChildren<{ fallbackRender: FallbackRender }>,\n  { error: Error | null }\n> {\n  state = { error: null };\n\n  // 当子组件抛出异常，这里会接收到并且调用\n  static getDerivedStateFromError(error: Error) {\n    return { error };\n  }\n\n  render() {\n    const { error } = this.state;\n    const { fallbackRender, children } = this.props;\n    if (error) {\n      return fallbackRender({ error });\n    }\n    return children;\n  }\n}\n","import React from \"react\";\nimport \"./App.css\";\nimport { useAuth } from \"context/auth-context\";\nimport { ErrorBoundary } from \"components/error-boundary\";\nimport { FullPageErrorFallback, FullPageLoading } from \"components/lib\";\n\nconst AuthenticatedApp = React.lazy(() => import(\"authenticated-app\"));\nconst UnauthenticatedApp = React.lazy(() => import(\"unauthenticated-app\"));\n\nfunction App() {\n  const { user } = useAuth();\n\n  return (\n    <div className=\"App\">\n      <ErrorBoundary fallbackRender={FullPageErrorFallback}>\n        <React.Suspense fallback={<FullPageLoading />}>\n          {user ? <AuthenticatedApp /> : <UnauthenticatedApp />}\n        </React.Suspense>\n      </ErrorBoundary>\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);  \n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n}\n\nexport default reportWebVitals;\n","import React, { ReactNode } from \"react\";\nimport { AuthProvider } from \"context/auth-context\";\nimport { QueryClient, QueryClientProvider } from \"react-query\";\nimport { BrowserRouter as Router } from \"react-router-dom\";\n\nexport const AppProviders = ({ children }: { children: ReactNode }) => {\n  const queryClient = new QueryClient({\n    defaultOptions: {\n      queries: {\n        refetchOnWindowFocus: false,\n      },\n    },\n  });\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <Router>\n        <AuthProvider>{children}</AuthProvider>\n      </Router>\n    </QueryClientProvider>\n  );\n};\n","import \"./wdyr\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { DevTools, loadServer } from \"jira-dev-tool\";\n// 务必在jira-dev-tool后面引入\nimport \"antd/dist/antd.less\";\nimport { AppProviders } from \"context\";\nimport { Profiler } from \"components/profiler\";\n\nloadServer(() =>\n  ReactDOM.render(\n    <React.StrictMode>\n      <Profiler id={\"Root App\"} phases={[\"mount\"]}>\n        <AppProviders>\n          <DevTools />\n          <App />\n        </AppProviders>\n      </Profiler>\n    </React.StrictMode>,\n    document.getElementById(\"root\")\n  )\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","// 在真实环境中，如果使用firebase这种第三方auth服务的话，本文件不需要开发者开发\n\nimport { User } from \"types/user\";\n\nconst apiUrl = process.env.REACT_APP_API_URL;\n\nconst localStorageKey = \"__auth_provider_token__\";\n\nexport const getToken = () => window.localStorage.getItem(localStorageKey);\n\nexport const handleUserResponse = ({ user }: { user: User }) => {\n  window.localStorage.setItem(localStorageKey, user.token || \"\");\n  return user;\n};\n\nexport const login = (data: { username: string; password: string }) => {\n  return fetch(`${apiUrl}/login`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify(data),\n  }).then(async (response) => {\n    if (response.ok) {\n      return handleUserResponse(await response.json());\n    } else {\n      return Promise.reject(await response.json());\n    }\n  });\n};\n\nexport const register = (data: { username: string; password: string }) => {\n  return fetch(`${apiUrl}/register`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify(data),\n  }).then(async (response) => {\n    if (response.ok) {\n      return handleUserResponse(await response.json());\n    } else {\n      return Promise.reject(await response.json());\n    }\n  });\n};\n\nexport const logout = async () =>\n  window.localStorage.removeItem(localStorageKey);\n","import styled from \"@emotion/styled\";\nimport React from \"react\";\nimport { Button, Spin, Typography } from \"antd\";\nimport { DevTools } from \"jira-dev-tool\";\n\nexport const Row = styled.div<{\n  gap?: number | boolean;\n  between?: boolean;\n  marginBottom?: number;\n}>`\n  display: flex;\n  align-items: center;\n  justify-content: ${(props) => (props.between ? \"space-between\" : undefined)};\n  margin-bottom: ${(props) => props.marginBottom + \"rem\"};\n\n  > * {\n    margin-top: 0 !important;\n    margin-bottom: 0 !important;\n    margin-right: ${(props) =>\n      typeof props.gap === \"number\"\n        ? props.gap + \"rem\"\n        : props.gap\n        ? \"2rem\"\n        : undefined};\n  }\n`;\n\nconst FullPage = styled.div`\n  height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`;\n\nexport const FullPageLoading = () => (\n  <FullPage>\n    <Spin size={\"large\"} />\n  </FullPage>\n);\n\nexport const FullPageErrorFallback = ({ error }: { error: Error | null }) => (\n  <FullPage>\n    <DevTools />\n    <ErrorBox error={error} />\n  </FullPage>\n);\n\n// 类型守卫\nconst isError = (value: any): value is Error => value?.message;\n\nexport const ErrorBox = ({ error }: { error: unknown }) => {\n  if (isError(error)) {\n    return <Typography.Text type={\"danger\"}>{error?.message}</Typography.Text>;\n  }\n  return null;\n};\n\nexport const ButtonNoPadding = styled(Button)`\n  padding: 0;\n`;\n\nexport const ScreenContainer = styled.div`\n  padding: 3.2rem;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n","import React, { ReactNode, useCallback } from \"react\";\nimport * as auth from \"auth-provider\";\nimport { http } from \"utils/http\";\nimport { useMount } from \"utils\";\nimport { useAsync } from \"utils/use-async\";\nimport { FullPageErrorFallback, FullPageLoading } from \"components/lib\";\nimport { User } from \"types/user\";\nimport { useQueryClient } from \"react-query\";\n\ninterface AuthForm {\n  username: string;\n  password: string;\n}\n\nconst bootstrapUser = async () => {\n  let user = null;\n  const token = auth.getToken();\n  if (token) {\n    const data = await http(\"me\", { token });\n    user = data.user;\n  }\n  return user;\n};\n\nconst AuthContext = React.createContext<\n  | {\n      user: User | null;\n      register: (form: AuthForm) => Promise<void>;\n      login: (form: AuthForm) => Promise<void>;\n      logout: () => Promise<void>;\n    }\n  | undefined\n>(undefined);\nAuthContext.displayName = \"AuthContext\";\n\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\n  const {\n    data: user,\n    error,\n    isLoading,\n    isIdle,\n    isError,\n    run,\n    setData: setUser,\n  } = useAsync<User | null>();\n  const queryClient = useQueryClient();\n\n  // point free\n  const login = (form: AuthForm) => auth.login(form).then(setUser);\n  const register = (form: AuthForm) => auth.register(form).then(setUser);\n  const logout = () =>\n    auth.logout().then(() => {\n      setUser(null);\n      queryClient.clear();\n    });\n\n  useMount(\n    useCallback(() => {\n      run(bootstrapUser());\n    }, [])\n  );\n\n  if (isIdle || isLoading) {\n    return <FullPageLoading />;\n  }\n\n  if (isError) {\n    return <FullPageErrorFallback error={error} />;\n  }\n\n  return (\n    <AuthContext.Provider\n      children={children}\n      value={{ user, login, register, logout }}\n    />\n  );\n};\n\nexport const useAuth = () => {\n  const context = React.useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth必须在AuthProvider中使用\");\n  }\n  return context;\n};\n","import { useEffect, useRef, useState } from \"react\";\n\nexport const isFalsy = (value: unknown) => (value === 0 ? false : !value);\n\nexport const isVoid = (value: unknown) =>\n  value === undefined || value === null || value === \"\";\n\n// let a: object\n// a = {name: 'jack'}\n// a = () => {\n// }\n// a = new RegExp('')\n//\n// let b: { [key: string]: unknown }\n// b = {name: 'Jack'}\n// b = () => {}\n// 在一个函数里，改变传入的对象本身是不好的\nexport const cleanObject = (object?: { [key: string]: unknown }) => {\n  // Object.assign({}, object)\n  if (!object) {\n    return {};\n  }\n  const result = { ...object };\n  Object.keys(result).forEach((key) => {\n    const value = result[key];\n    if (isVoid(value)) {\n      delete result[key];\n    }\n  });\n  return result;\n};\n\nexport const useMount = (callback: () => void) => {\n  useEffect(() => {\n    callback();\n  }, [callback]);\n};\n\n// const debounce = (func, delay) => {\n//   let timeout;\n//   return (...param) => {\n//     if (timeout) {\n//       clearTimeout(timeout);\n//     }\n//     timeout = setTimeout(function() {\n//       func(...param);\n//     }, delay);\n//   }\n// }\n// const log = debounce(() => console.log('call'), 5000)\n// log()\n// log()\n// log()\n//   ...5s\n// 执行！\n\n// debounce 原理讲解：\n// 0s ---------> 1s ---------> 2s --------> ...\n//     一定要理解：这三个函数都是同步操作，所以它们都是在 0~1s 这个时间段内瞬间完成的；\n//     log()#1 // timeout#1\n//     log()#2 // 发现 timeout#1！取消之，然后设置timeout#2\n//     log()#3 // 发现 timeout#2! 取消之，然后设置timeout#3\n//             // 所以，log()#3 结束后，就只剩timeout#3在独自等待了\n\n// 后面用泛型来规范类型\nexport const useDebounce = <V>(value: V, delay?: number) => {\n  const [debouncedValue, setDebouncedValue] = useState(value);\n\n  useEffect(() => {\n    // 每次在value变化以后，设置一个定时器\n    const timeout = setTimeout(() => setDebouncedValue(value), delay);\n    // 每次在上一个useEffect处理完以后再运行\n    return () => clearTimeout(timeout);\n  }, [value, delay]);\n\n  return debouncedValue;\n};\n\nexport const useArray = <T>(initialArray: T[]) => {\n  const [value, setValue] = useState(initialArray);\n  return {\n    value,\n    setValue,\n    add: (item: T) => setValue([...value, item]),\n    clear: () => setValue([]),\n    removeIndex: (index: number) => {\n      const copy = [...value];\n      copy.splice(index, 1);\n      setValue(copy);\n    },\n  };\n};\n\nexport const useDocumentTitle = (title: string, keepOnUnmount = true) => {\n  const oldTitle = useRef(document.title).current;\n  // 页面加载时: 旧title\n  // 加载后：新title\n\n  useEffect(() => {\n    document.title = title;\n  }, [title]);\n\n  useEffect(() => {\n    return () => {\n      if (!keepOnUnmount) {\n        // 如果不指定依赖，读到的就是旧title\n        document.title = oldTitle;\n      }\n    };\n  }, [keepOnUnmount, oldTitle]);\n};\n\nexport const resetRoute = () => (window.location.href = window.location.origin);\n\n/**\n * 传入一个对象，和键集合，返回对应的对象中的键值对\n * @param obj\n * @param keys\n */\nexport const subset = <\n  O extends { [key in string]: unknown },\n  K extends keyof O\n>(\n  obj: O,\n  keys: K[]\n) => {\n  const filteredEntries = Object.entries(obj).filter(([key]) =>\n    keys.includes(key as K)\n  );\n  return Object.fromEntries(filteredEntries) as Pick<O, K>;\n};\n\n/**\n * 返回组件的挂载状态，如果还没挂载或者已经卸载，返回false；反之，返回true\n */\nexport const useMountedRef = () => {\n  const mountedRef = useRef(false);\n\n  useEffect(() => {\n    mountedRef.current = true;\n    return () => {\n      mountedRef.current = false;\n    };\n  });\n\n  return mountedRef;\n};\n"],"sourceRoot":""}